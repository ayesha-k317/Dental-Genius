<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Staff Dashboard</title>
  <link rel="stylesheet" href="your-css-file.css" />
  <style>
    /* You can also paste your entire CSS here if no external file */
  </style>
</head>
<body>

  <!-- Sidebar and hamburger menu markup based on your CSS (simplified) -->
  <div class="hamburger-menu" id="hamburgerMenu">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>

  <nav class="sidebar-nav" id="sidebarNav">
    <a href="#" class="nav-item active">Dashboard</a>
    <a href="#" class="nav-item">Appointments</a>
    <a href="#" class="nav-item nav-logout">Logout</a>
  </nav>

  <main class="container">
    <h1 class="welcome-text">Staff Dashboard</h1>

    <section class="appointment-section">
      <h2>All Appointments</h2>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Full Name</th>
              <th>Email</th>
              <th>Treatment</th>
              <th>Appointment Time</th>
            </tr>
          </thead>
          <tbody id="appointmentsTableBody" class="appointment-data">
            <!-- Data rows will be injected here -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // Sidebar toggle logic
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const sidebarNav = document.getElementById('sidebarNav');
    hamburgerMenu.addEventListener('click', () => {
      sidebarNav.classList.toggle('active');
    });

    // Fetch and render appointments
    async function loadAppointments() {
      try {
        const response = await fetch('/appointments');
        const data = await response.json();

        const tbody = document.getElementById('appointmentsTableBody');
        tbody.innerHTML = ''; // Clear existing rows

        data.forEach(appt => {
          // Safely parse date
          const apptDate = new Date(appt.appointmentTime);
          const validDate = !isNaN(apptDate.getTime());
          const dateStr = validDate ? apptDate.toLocaleString() : 'Invalid Date';

          // Combine full name safely
          const fullName = `${appt.firstName || ''} ${appt.lastName || ''}`.trim() || 'No Name';

          const row = document.createElement('tr');

          row.innerHTML = `
            <td>${fullName}</td>
            <td>${appt.email || 'No Email'}</td>
            <td>${appt.treatment || 'No Treatment'}</td>
            <td>${dateStr}</td>
          `;

          tbody.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading appointments:', error);
      }
    }

    // Initial load
    loadAppointments();

    setInterval(loadAppointments, 60000);
  </script>
</body>
</html>
